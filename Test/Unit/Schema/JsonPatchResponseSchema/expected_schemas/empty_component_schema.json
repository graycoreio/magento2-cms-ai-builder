{
    "type": "json_schema",
    "name": "json_patch_response",
    "schema": {
        "type": "object",
        "$defs": {
            "DaffContentSchema": {
                "anyOf": [
                    {"$ref": "#/$defs/DaffTextSchema"},
                    {"$ref": "#/$defs/DaffContentElementSchema"},
                    {"$ref": "#/$defs/DaffContentComponentSchema"}
                ]
            },
            "DaffTextSchema": {
                "type": "object",
                "properties": {
                    "type": {"type": "string", "const": "textSchema"},
                    "text": {"type": "string"}
                },
                "required": ["type", "text"],
                "additionalProperties": false
            },
            "DaffContentElementSchema": {
                "type": "object",
                "properties": {
                    "type": {"type": "string", "const": "elementSchema"},
                    "element": {"type": "string"},
                    "attributes": {
                        "type": "object",
                        "additionalProperties": {"type": "string"}
                    },
                    "children": {
                        "type": "array",
                        "items": {"$ref": "#/$defs/DaffContentSchema"}
                    },
                    "styles": {"$ref": "#/$defs/StylesObject"}
                },
                "required": ["type", "element", "children", "styles"],
                "additionalProperties": false
            },
            "DaffContentComponentSchema": {
                "anyOf": []
            },
            "CssStyleObject": {
                "type": "object",
                "description": "CSS styles as key-value pairs (e.g. {\"margin\": \"10px\", \"display\": \"flex\"}).",
                "properties": {},
                "required": [],
                "additionalProperties": {
                    "anyOf": [
                        {"type": "string"},
                        {"type": "number"}
                    ]
                }
            },
            "BreakpointsObject": {
                "type": "object",
                "description": "Responsive styles keyed by media query condition.",
                "properties": {},
                "required": [],
                "additionalProperties": {"$ref": "#/$defs/CssStyleObject"}
            },
            "StylesObject": {
                "type": "object",
                "description": "Element styles with base and responsive breakpoints.",
                "properties": {
                    "base": {"$ref": "#/$defs/CssStyleObject"},
                    "breakpoints": {"$ref": "#/$defs/BreakpointsObject"}
                },
                "required": ["base", "breakpoints"],
                "additionalProperties": false
            },
            "JsonValue": {
                "anyOf": [
                    {"type": "string"},
                    {"type": "number"},
                    {"type": "boolean"},
                    {"type": "null"},
                    {"$ref": "#/$defs/DaffContentSchema"},
                    {"$ref": "#/$defs/StylesObject"},
                    {"$ref": "#/$defs/BreakpointsObject"},
                    {"$ref": "#/$defs/CssStyleObject"}
                ]
            }
        },
        "properties": {
            "reply": {
                "type": "string",
                "description": "Brief explanation of changes made"
            },
            "patch": {
                "type": "array",
                "description": "Array of JSON Patch operations (RFC 6902)",
                "items": {
                    "type": "object",
                    "properties": {
                        "op": {
                            "type": "string",
                            "enum": ["add", "remove", "replace", "move", "copy", "test"],
                            "description": "The operation to perform"
                        },
                        "path": {
                            "type": "string",
                            "description": "JSON Pointer to the target location"
                        },
                        "value": {
                            "$ref": "#/$defs/JsonValue"
                        },
                        "from": {
                            "type": "string",
                            "description": "JSON Pointer to source location (required for move and copy operations, empty string for others)"
                        }
                    },
                    "required": ["op", "path", "value", "from"],
                    "additionalProperties": false
                }
            }
        },
        "required": ["reply", "patch"],
        "additionalProperties": false
    }
}